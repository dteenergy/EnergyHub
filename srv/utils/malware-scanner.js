/**
 * This module contains SAP Malware Scanning Service
 * @link https://api.sap.com/api/MalwareScanAPI/cloud-sdk/JavaScript
 */

const {DefaultApi} = require('../external/service/MalwareScanAPI');

const destinations = require('../../destinations');
const scanfile = async (file) =>{
    try {
        const ack = await DefaultApi.createSca(file)
            .addCustomHeaders({ 'Content-Type': 'application/octet-stream' })
            .addCustomHeaders({ 'Accept': 'application/json' })
            .execute(destinations['dteConsentAppPortal-malwarescanner-dest']);     

        // Verify that malware and encrypted content are not detected
        if(!ack.malwareDetected && !ack.encryptedContentDetected) return ack;

        throw new Error(JSON.stringify(ack));
    } catch (error) {
        console.error('Malware Scanner Error: ',error);
        throw error
    }
}

module.exports = {
    scanfile
}