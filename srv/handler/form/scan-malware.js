const malwareScanningService = require('../../utils/malware-scanning-service');

/**
 * Scan Malware Action
 * @param {Request} req 
 * @returns {object} ack
 * @throws {Error}
 */
const scanMalware = async (req) =>{
    try {
        const {Attachment} = req.data;

        // Convert base64 to binary
        const binaryContent = Buffer.from(Attachment.fileContent, 'base64').toString('binary');

        // Scan file
        const ack = malwareScanningService.scanfile(binaryContent);
        
        return ack;
    } catch (error) {
        console.log('Scan Malware Action Error: ', error);
        req.warn(error);
    }
}

module.exports= {
    scanMalware
}