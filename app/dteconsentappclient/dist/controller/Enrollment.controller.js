sap.ui.define(["dteconsentappclient/controller/BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","dteconsentappclient/variable/GlobalInputValues"],(e,t,n,o)=>{"use strict";let i,s,a,l={accountDetailsValidation:true,siteDetailsValidation:true,customerAuthDetailValidation:true,locationDetailsValidation:true,consentDetailValidation:true,consentAuthDetailValidation:true};return e.extend("dteconsentappclient.controller.Enrollment",{onInit(){const{url:e}=this.getApiConfig();this.SERVERHOST=e;let t={SignatureSignedBy:"",SignatureSignedDate:"",AccountDetail:{CompanyName:"",CompanyAddress:"",City:"",State:"",Zipcode:"",EnergyPrgmParticipated:false,AcctMgrName:"",AcctMgrPhNo:"",SiteFirstName:"",SiteLastName:"",SiteContactTitle:"",SiteAddress:"",SiteCity:"",SiteState:"",SiteZipcode:null,SitePhoneNumber:"",SiteEmailAddr:""}};const i=new n(t);this.getView().setModel(i,"oEnrollModel");let s={ConsentDetail:{ConsentFirstName:"",ConsentLastName:"",ConsentContactTitle:"",ConsentAddress:"",ConsentCity:"",ConsentState:"",ConsentZipcode:null,ConsentAccountNumber:"",ConsentPhoneNumber:"",ConsentEmailAddr:"",AuthPersonName:"",AuthDate:"",AuthTitle:""}};const a=new n(s);this.getView().setModel(a,"oConsentModel");const l=new n({locations:[]});this.getView().setModel(l,"locationModel");const r=new n({isInputInValid:false,isTermsAndConditionVerifiedStatus:false});this.getView().setModel(r,"oErrorVisibilityModel");const c=new n(o);this.getView().setModel(c,"ostateValuesModel");this.onAddAnotherLocation();this.loadConsentForm();this.loadAuthAndRelease()},onAddAnotherLocation:function(){const e=this.getView();const n=e.getModel("locationModel");const o=this.byId("building-detail-main-container");const i=n.getProperty("/locations");i.push({BuildingName:"",AccountNumber:"",Address:"",City:"",State:"Michigan",Zipcode:""});n.setProperty("/locations",i);const s=i.length-1;t.load({name:"dteconsentappclient.fragment.Buildingdetail",controller:this}).then(function(e){let t=[];if(s>0){const e=new sap.m.Title({text:`Location ${s+1}`,titleStyle:"H6"});e.addStyleClass("location-inner-title");t=[e]}e.setModel(n,"locationMoel");e.bindElement(`locationModel>/locations/${s}`);const i=new sap.m.FlexBox({items:[...t,e],direction:"Column"});o.addItem(i)}).catch(function(e){console.log(`Failed to load fragment: ${e}`)})},onRadioButtonSelect:function(e){let t=e.getSource().getSelectedButton().getText();let n=false;if(t==="Yes")n=true;else n;let o=this.getView().getModel("oEnrollModel");o.setProperty("/AccountDetail/EnergyPrgmParticipated",n)},loadConsentForm:function(){const e=this.getView();const n=e.getModel("oConsentModel");const o=this.byId("enrollment-consent-section");t.load({name:"dteconsentappclient.fragment.Consentform",controller:this}).then(function(e){e.setModel(n,"oConsentModel");e.bindElement("oConsentModel");o.addItem(e)}).catch(function(e){console.log(`Failed to load fragment: ${e}`)})},loadAuthAndRelease:function(){const e=this.getView().getModel("oConsentModel");const n=this.byId("customer-auth-and-release-container");t.load({name:"dteconsentappclient.fragment.AuthAndRelease",controller:this}).then(function(t){t.setModel(e,"oConsentModel");t.bindElement("oConsentModel");n.addItem(t)}).catch(function(e){console.log(`Failed to load fragment: ${e}`)})},onConsentAndSiteSameSelected:function(e){const t=e.getParameters().selected;const n=this.getView().getModel("oEnrollModel");const o=n.getData();const i=this.getView().getModel("oConsentModel");const s=i.getData();const a=Object.keys(o.AccountDetail);if(t){a.map(e=>{if(e.startsWith("Site")){const t=e.replace("Site","Consent");i.setProperty(`/ConsentDetail/${t}`,o["AccountDetail"][e])}});this.validateFormDetails("enrollment-consent-section",false,"oConsentModel","consentDetailValidation")}else{i.setProperty("/ConsentDetail",{FirstName:"",LastName:"",ConsentContactTitle:"",ConsentAddress:"",ConsentCity:"",ConsentState:"",ConsentZipcode:null,ConsentAccountNumber:"",ConsentPhoneNumber:"",ConsentEmailAddr:"",AuthPersonName:s["ConsentDetail"]["AuthPersonName"],AuthDate:s["ConsentDetail"]["AuthPersonName"],AuthTitle:s["ConsentDetail"]["AuthPersonName"]})}},handleTermsAndConditionVerified:function(e){const t=e.getSource();const n=e.getParameters().selected;const o=this.getView().getModel("oErrorVisibilityModel");const i=t.$().find(".sapMCbBg");if(n){i.removeClass("checkbox-error-view");o.setProperty("/isTermsAndConditionVerifiedStatus",false)}else{i.addClass("checkbox-error-view");o.setProperty("/isTermsAndConditionVerifiedStatus",true)}},validateFormDetails:function(e,t,n,o){const i=this.getView().getModel(n);const s=this.byId(e);l[o]=true;s.findAggregatedObjects(true,e=>{if(e instanceof sap.m.Input&&!e.getId().includes("-popup-input")||e instanceof sap.m.ComboBox||e instanceof sap.m.MaskInput){const n=e.getBinding("value")?.getPath()||e.getBinding("selectedKey")?.getPath();if(n){const s=i.getProperty(n);if((!s||s?.trim()==="")&&e?.mProperties["required"]){if(t){e.setValueState("Error")}l[o]=false}else{e.setValueState("None")}}}})},onLiveChange:function(e){const t=e.getSource();const n=e.getParameter("value")||e.getParameter("selectedKey");if(n?.trim()!==""&&t?.mProperties["required"]){t.setValueState("None")}else{t.setValueState("Error")}},validateBuildingDetails:function(e){const t=this.getView().getModel("locationModel");const n=this.byId(e);l["locationDetailsValidation"]=true;n.getItems().forEach((e,n)=>{e.findAggregatedObjects(true,e=>{if(e instanceof sap.m.Input&&!e.getId().includes("-popup-input")||e instanceof sap.m.ComboBox){const o=e.getBinding("value")?.getPath()||e.getBinding("selectedKey")?.getPath();if(o){const i=t.getProperty(`/locations/${n}/${o}`);if((!i||i?.trim()==="")&&e?.mProperties["required"]){e.setValueState("Error");l["locationDetailsValidation"]=false}}}})})},retrieveAllInputbindings:function(){i=this.getView().getModel("oEnrollModel").getData();console.log(i);s=this.getView().getModel("oConsentModel").getData()?.ConsentDetail;console.log(s);a=this.getView().getModel("locationModel").getData();console.log(a)},validateTermsAndConditionIsVerified:function(e){const t=this.getView().getModel("oErrorVisibilityModel");const n=this.byId(e);n.findAggregatedObjects(true,e=>{if(e instanceof sap.m.CheckBox){const n=e.getSelected();console.log(n);const o=e.$().find(".sapMCbBg");if(n){t.setProperty("/isTermsAndConditionVerifiedStatus",false);o.removeClass("checkbox-error-view");console.log("checked")}else{t.setProperty("/isTermsAndConditionVerifiedStatus",true);o.addClass("checkbox-error-view");console.log("unchecked")}}})},setErrorMessageTripVisibility:function(){const e=this.getView().getModel("oErrorVisibilityModel");console.log(Object.values(l));if(Object.values(l).includes(false))e.setProperty("/isInputInValid",true);else e.setProperty("/isInputInValid",false)},convertDateFormat:function(e){const[t,n,o]=e.split("/");return`${o}-${n}-${t}`},submitAction:async function(){const e=this.getView().getModel("oErrorVisibilityModel");const t=e.getData();console.log("axios call");if(!t?.isInputInValid&&!t?.isTermsAndConditionVerifiedStatus){this.retrieveAllInputbindings();const e=this.SERVERHOST+"service/CreateEnrollmentFormDetail";const t={AccountDetail:JSON.stringify({...i["AccountDetail"],FirstName:i["AccountDetail"]["SiteFirstName"],LastName:i["AccountDetail"]["SiteLastName"],EmailAddr:i["AccountDetail"]["SiteEmailAddr"]}),BuildingDetail:JSON.stringify(a["locations"]),ApplicationDetail:JSON.stringify({SignatureSignedBy:i["SignatureSignedBy"],SignatureSignedDate:this.convertDateFormat(i["SignatureSignedDate"])}),ConsentDetail:JSON.stringify([{FirstName:s["ConsentFirstName"],LastName:s["ConsentLastName"],SiteContactTitle:s["ConsentContactTitle"],Address:s["ConsentAddress"],City:s["ConsentCity"],State:s["ConsentState"],Zipcode:s["ConsentZipcode"],AccountNumber:s["ConsentAccountNumber"],PhoneNumber:s["ConsentPhoneNumber"],EmailAddr:s["ConsentEmailAddr"],AuthPersonName:s["AuthPersonName"],AuthDate:this.convertDateFormat(s["AuthDate"]),AuthTitle:s["AuthTitle"]}])};const{data:n}=await axios.post(e,t);if(n.value.statusCode===200){this.getOwnerComponent().getRouter().navTo("Confirmation",{StatusCode:n.value.statusCode,Message:n.value.Message})}}},handleSubmit:async function(){this.validateFormDetails("account-info-container",true,"oEnrollModel","accountDetailsValidation");this.validateFormDetails("site-contact-info-container",true,"oEnrollModel","siteDetailsValidation");this.validateBuildingDetails("building-detail-main-container");this.validateFormDetails("auth-info-container",true,"oEnrollModel","customerAuthDetailValidation");this.validateFormDetails("enrollment-consent-section",true,"oConsentModel","consentDetailValidation");this.validateFormDetails("customer-auth-and-release-container",true,"oConsentModel","consentAuthDetailValidation");this.validateTermsAndConditionIsVerified("customer-auth-and-release-container");this.setErrorMessageTripVisibility();this.submitAction()}})});
//# sourceMappingURL=Enrollment.controller.js.map